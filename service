#!/usr/bin/python2.7

from time import sleep, time
from datetime import date
from requests import Session
import json
import shutil
import os

URL = "https://www.chaosdorf.de/~ytvwld/freitagsfoo.json"
LOADING_DATA = {
    "hosts": ["..."],
    "date": str(date.today()),
    "talks": [{
        "title": "...",
        "description": "...",
        "persons": [],
    }]
}


def save_text(content):
    curr_time = time()
    filename = "freitagsfoo-%s.json" % str(curr_time)
    f = open(filename, "w")
    f.write(content)
    f.close()
    shutil.copy(filename, "freitagsfoo.json")
    shutil.copy(filename, "talks_screen/freitagsfoo.json")
    shutil.copy(filename, "title_screen/freitagsfoo.json")
    os.remove(filename)


save_text(json.dumps(LOADING_DATA))

session = Session()
while True:
    r = session.get(URL)
    save_text(r.text)
    sleep(60)
